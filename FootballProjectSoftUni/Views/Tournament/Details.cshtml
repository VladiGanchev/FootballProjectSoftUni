@using FootballProjectSoftUni.Core.Models.Tournament;
@using FootballProjectSoftUni.Extensions
@using FootballProjectSoftUni.Infrastructure.Data.Enums;
@model DetailsViewModel
@{
    ViewBag.Title = "Tournament Details";
}


<h2 class="text-center">@ViewBag.Title</h2>
<hr />

<div class="row">
    <div class="card w-100">
        <div class="card-body">
            <h3 class="card-title text-center">@Model.Description</h3>
            <p class="mb-0"><span class="fw-bold">Starting Time: </span>@Model.StartDate</p>
            <p class="mb-0"><span class="fw-bold">Ending Time: </span>@Model.EndDate</p>
            <p class="mb-0"><span class="fw-bold">Created On: </span>@Model.CreatedOn</p>
            <p class="mb-0"><span class="fw-bold">Number Of Teams: </span>@Model.NumberOfTeams</p>
            <p class="mb-0"><span class="fw-bold">Referee: </span>@Model.RefereeName</p>
            <p class="mb-0"><span class="fw-bold">Participation Fee: </span>@Model.ParticipationFee.ToString("C2", new System.Globalization.CultureInfo("de-DE"))</p>
            <p class="mb-0"><span class="fw-bold">Prize: </span>@Model.Prize.ToString("C2", new System.Globalization.CultureInfo("de-DE"))</p>

            @{
                if (Model.StartDate > DateTime.Now)
                {
                    <p class="mb-0"><span class="fw-bold">Status: </span>@TournamentStatus.Upcoming</p>
                }
                else if (DateTime.Now > Model.StartDate && DateTime.Now < Model.EndDate)
                {
                    <p class="mb-0"><span class="fw-bold">Status: </span>@TournamentStatus.Started</p>
                }
                else if (DateTime.Now > Model.EndDate)
                {
                    <p class="mb-0"><span class="fw-bold">Status: </span>@TournamentStatus.Finished</p>
                }
            }
            <p class="mb-0">
                <span class="fw-bold">Participants: </span>
                @if (Model.ParticipantTeams != null && Model.ParticipantTeams.Any())
                {
                    @string.Join(", ", Model.ParticipantTeams)
                }
                else
                {
                    @:No teams registered yet.
                }
            </p>

            @if (!string.IsNullOrWhiteSpace(Model.Winner))
            {
                <p class="mb-0"><span class="fw-bold">Winner: </span>@Model.Winner</p>
            }

            <a asp-controller="Tournament" asp-action="CityTournaments" asp-route-id="@Model.CityId" class="btn btn-warning mb-2 w-100 p-3 fw-bold">Back to All Tournaments</a>
            @if (User.IsAdmin())
            {
                <a asp-controller="Tournament" asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning mb-2 w-100 p-3 fw-bold">Edit</a>
            }

        </div>


    </div>
</div>

@if (Model.Matches != null && Model.Matches.Any())
{
    <hr />
    <h3 class="text-center mt-4">Схема на турнира</h3>

    @foreach (var roundGroup in Model.Matches.GroupBy(m => m.Round).OrderBy(g => g.Key))
    {
        <h4 class="mt-3">Рунд @roundGroup.Key</h4>

        <table class="table table-bordered">
            <thead>
                <tr>
                    <th class="text-center">Отбор 1</th>
                    <th class="text-center">Резултат</th>
                    <th class="text-center">Отбор 2</th>
                    <th class="text-center">Победител</th>
                    <th class="text-center"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var match in roundGroup)
                {
                    <tr>
                        <td class="text-center">@match.Team1Name</td>
                        <td class="text-center">
                            @if (match.Team1Goals.HasValue && match.Team2Goals.HasValue)
                            {
                                @($"{match.Team1Goals}:{match.Team2Goals}")
                            }
                            else
                            {
                                @: -
                            }
                        </td>
                        <td class="text-center">@match.Team2Name</td>
                        <td class="text-center">
                            @if (!string.IsNullOrEmpty(match.WinnerTeamName))
                            {
                                @match.WinnerTeamName
                            }
                            else
                            {
                                @: -
                            }
                        </td>
                        <td class="text-center">
                            @if (User.IsAdmin()
                                            && match.Team1Id.HasValue
                                            && match.Team2Id.HasValue)
                            {
                                <a asp-controller="Match"
                                   asp-action="EnterResult"
                                   asp-route-id="@match.Id"
                                   class="btn btn-sm btn-primary">
                                    Въведи / редактирай резултат
                                </a>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
}
else
{
    <p class="mt-4 text-center">Все още няма схема за този турнир.</p>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}


